# ============================================================
# Render Blueprint — JobAgent
# Documentation : https://render.com/docs/blueprint-spec
#
# Déploiement : Docker (env: docker) via Dockerfile à la racine
# L'image de base mcr.microsoft.com/playwright embarque toutes les
# libs système Chromium (libgtk-4, libgraphene, GStreamer, libGLESv2…)
# sans nécessiter sudo/su pendant le build.
#
# Variables marquées sync:false → à renseigner manuellement dans
# le dashboard Render (Environment > Add Secret)
# ============================================================

services:
  - type: web
    name: jobagent
    env: docker                # Utilise le Dockerfile à la racine du projet
    region: frankfurt          # Proche de Supabase eu-west-1
    plan: starter              # 512 MB RAM — passer à "standard" si nécessaire

    # ── Variables d'environnement ──────────────────────────
    # sync:false = secret à saisir dans le dashboard Render, non versionné ici
    envVars:

      # --- Supabase (PostgreSQL) ---
      # URL PgBouncer (pooling) — utilisée par Prisma en runtime
      - key: DATABASE_URL
        sync: false
      # URL directe (sans pooling) — utilisée par Prisma pour les migrations
      - key: DIRECT_URL
        sync: false
      # URL publique Supabase (visible côté client)
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      # Clé anonyme Supabase (visible côté client, accès limité par RLS)
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      # Clé service role Supabase (accès admin, NE JAMAIS exposer côté client)
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false

      # --- Better Auth ---
      # Secret de session (générer : openssl rand -base64 32)
      - key: AUTH_SECRET
        sync: false
      # URL publique du service (ex: https://jobagent.onrender.com)
      - key: BETTER_AUTH_URL
        sync: false
      # Même valeur, côté client
      - key: NEXT_PUBLIC_BETTER_AUTH_URL
        sync: false
      # Origins de confiance supplémentaires séparées par des virgules (domaines custom)
      - key: BETTER_AUTH_TRUSTED_ORIGINS
        sync: false

      # --- Anthropic (Agent IA) ---
      - key: ANTHROPIC_API_KEY
        sync: false

      # --- Inngest (Jobs planifiés) ---
      - key: INNGEST_EVENT_KEY
        sync: false
      - key: INNGEST_SIGNING_KEY
        sync: false

      # --- Resend (Emails transactionnels) ---
      - key: RESEND_API_KEY
        sync: false
